{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/Pamo/v0-hrm/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\r\nimport { cookies } from \"next/headers\"\r\n\r\nexport async function createClient() {\r\n  const cookieStore = await cookies()\r\n\r\n  return createServerClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!, {\r\n    cookies: {\r\n      getAll() {\r\n        return cookieStore.getAll()\r\n      },\r\n      setAll(cookiesToSet) {\r\n        try {\r\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\r\n        } catch {\r\n          // The \"setAll\" method was called from a Server Component.\r\n          // This can be ignored if you have proxy refreshing user sessions.\r\n        }\r\n      },\r\n    },\r\n  })\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0QAAO;IAEjC,OAAO,IAAA,4SAAkB,oKAAoF;QAC3G,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,kEAAkE;gBACpE;YACF;QACF;IACF;AACF"}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///E:/Pamo/v0-hrm/lib/actions/employee-actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport type { Employee, EmployeeWithRelations, UserRoleWithRelations } from \"@/lib/types/database\"\r\n\r\nexport async function getMyEmployee(): Promise<EmployeeWithRelations | null> {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return null\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"employees\")\r\n    .select(`\r\n      *,\r\n      department:departments(*),\r\n      position:positions(*),\r\n      manager:employees!manager_id(id, full_name, email)\r\n    `)\r\n    .eq(\"user_id\", user.id)\r\n    .single()\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching employee:\", error)\r\n    return null\r\n  }\r\n\r\n  return data as EmployeeWithRelations\r\n}\r\n\r\nexport async function getMyRoles(): Promise<UserRoleWithRelations[]> {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return []\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"user_roles\")\r\n    .select(`\r\n      *,\r\n      role:roles(*)\r\n    `)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching roles:\", error)\r\n    return []\r\n  }\r\n\r\n  return (data || []) as UserRoleWithRelations[]\r\n}\r\n\r\nexport async function listEmployees(): Promise<EmployeeWithRelations[]> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"employees\")\r\n    .select(`\r\n      *,\r\n      department:departments(*),\r\n      position:positions(*)\r\n    `)\r\n    .order(\"created_at\", { ascending: false })\r\n\r\n  if (error) {\r\n    console.error(\"Error listing employees:\", error)\r\n    return []\r\n  }\r\n\r\n  return (data || []) as EmployeeWithRelations[]\r\n}\r\n\r\nexport async function getEmployee(id: string): Promise<EmployeeWithRelations | null> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"employees\")\r\n    .select(`\r\n      *,\r\n      department:departments(*),\r\n      position:positions(*),\r\n      manager:employees!manager_id(id, full_name, email),\r\n      shift:work_shifts(*)\r\n    `)\r\n    .eq(\"id\", id)\r\n    .single()\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching employee:\", error)\r\n    return null\r\n  }\r\n\r\n  return data as EmployeeWithRelations\r\n}\r\n\r\nexport async function updateEmployee(\r\n  id: string,\r\n  data: Partial<Pick<Employee, \"full_name\" | \"phone\" | \"department_id\" | \"position_id\" | \"shift_id\" | \"status\" | \"join_date\">>,\r\n) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase\r\n    .from(\"employees\")\r\n    .update({ ...data, updated_at: new Date().toISOString() })\r\n    .eq(\"id\", id)\r\n\r\n  if (error) {\r\n    console.error(\"Error updating employee:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/employees\")\r\n  revalidatePath(`/dashboard/employees/${id}`)\r\n  return { success: true }\r\n}\r\n\r\nexport async function updateMyProfile(data: Partial<Pick<Employee, \"full_name\" | \"phone\">>) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"employees\")\r\n    .update({ ...data, updated_at: new Date().toISOString() })\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"Error updating profile:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/profile\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function createEmployee(data: {\r\n  full_name: string\r\n  email: string\r\n  phone?: string | null\r\n  department_id?: string | null\r\n  position_id?: string | null\r\n  join_date?: string | null\r\n}) {\r\n  const supabase = await createClient()\r\n\r\n  // Generate employee code\r\n  const code = `NV${new Date().toISOString().slice(0, 7).replace(\"-\", \"\")}${Math.floor(Math.random() * 10000)\r\n    .toString()\r\n    .padStart(4, \"0\")}`\r\n\r\n  const { error } = await supabase.from(\"employees\").insert({\r\n    employee_code: code,\r\n    full_name: data.full_name,\r\n    email: data.email,\r\n    phone: data.phone,\r\n    department_id: data.department_id,\r\n    position_id: data.position_id,\r\n    join_date: data.join_date,\r\n    status: \"onboarding\",\r\n  })\r\n\r\n  if (error) {\r\n    console.error(\"Error creating employee:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/employees\")\r\n  return { success: true }\r\n}\r\n\r\n// Đổi phòng ban + lưu lịch sử\r\nexport async function changeDepartment(\r\n  employeeId: string,\r\n  newDepartmentId: string,\r\n  salary?: number\r\n) {\r\n  const supabase = await createClient()\r\n\r\n  // Lấy thông tin hiện tại\r\n  const { data: employee } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"department_id, position_id\")\r\n    .eq(\"id\", employeeId)\r\n    .single()\r\n\r\n  if (!employee) return { success: false, error: \"Employee not found\" }\r\n\r\n  const today = new Date().toISOString().split(\"T\")[0]\r\n\r\n  // Đóng record lịch sử cũ\r\n  await supabase\r\n    .from(\"employee_job_history\")\r\n    .update({ end_date: today })\r\n    .eq(\"employee_id\", employeeId)\r\n    .is(\"end_date\", null)\r\n\r\n  // Tạo record lịch sử mới\r\n  await supabase.from(\"employee_job_history\").insert({\r\n    employee_id: employeeId,\r\n    department_id: newDepartmentId,\r\n    position_id: employee.position_id,\r\n    salary: salary || null,\r\n    start_date: today,\r\n  })\r\n\r\n  // Update employee\r\n  const { error } = await supabase\r\n    .from(\"employees\")\r\n    .update({ department_id: newDepartmentId, updated_at: new Date().toISOString() })\r\n    .eq(\"id\", employeeId)\r\n\r\n  if (error) {\r\n    console.error(\"Error changing department:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/employees\")\r\n  revalidatePath(`/dashboard/employees/${employeeId}`)\r\n  return { success: true }\r\n}\r\n\r\n// Đổi chức vụ + lưu lịch sử\r\nexport async function changePosition(\r\n  employeeId: string,\r\n  newPositionId: string,\r\n  salary?: number\r\n) {\r\n  const supabase = await createClient()\r\n\r\n  // Lấy thông tin hiện tại\r\n  const { data: employee } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"department_id, position_id\")\r\n    .eq(\"id\", employeeId)\r\n    .single()\r\n\r\n  if (!employee) return { success: false, error: \"Employee not found\" }\r\n\r\n  const today = new Date().toISOString().split(\"T\")[0]\r\n\r\n  // Đóng record lịch sử cũ\r\n  await supabase\r\n    .from(\"employee_job_history\")\r\n    .update({ end_date: today })\r\n    .eq(\"employee_id\", employeeId)\r\n    .is(\"end_date\", null)\r\n\r\n  // Tạo record lịch sử mới\r\n  await supabase.from(\"employee_job_history\").insert({\r\n    employee_id: employeeId,\r\n    department_id: employee.department_id,\r\n    position_id: newPositionId,\r\n    salary: salary || null,\r\n    start_date: today,\r\n  })\r\n\r\n  // Update employee\r\n  const { error } = await supabase\r\n    .from(\"employees\")\r\n    .update({ position_id: newPositionId, updated_at: new Date().toISOString() })\r\n    .eq(\"id\", employeeId)\r\n\r\n  if (error) {\r\n    console.error(\"Error changing position:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/employees\")\r\n  revalidatePath(`/dashboard/employees/${employeeId}`)\r\n  return { success: true }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 293, "column": 0}, "map": {"version":3,"sources":["file:///E:/Pamo/v0-hrm/lib/actions/attendance-actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport type { AttendanceLog, AttendanceLogWithRelations } from \"@/lib/types/database\"\r\n\r\nexport async function getMyAttendance(from?: string, to?: string): Promise<AttendanceLog[]> {\r\n  const supabase = await createClient()\r\n\r\n  const { data: { user } } = await supabase.auth.getUser()\r\n  if (!user) return []\r\n\r\n  // Lấy employee_id của user\r\n  const { data: employee } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"id\")\r\n    .eq(\"user_id\", user.id)\r\n    .single()\r\n\r\n  if (!employee) return []\r\n\r\n  let query = supabase\r\n    .from(\"attendance_logs\")\r\n    .select(\"*\")\r\n    .eq(\"employee_id\", employee.id)\r\n    .order(\"check_in\", { ascending: false })\r\n\r\n  if (from) query = query.gte(\"check_in\", from)\r\n  if (to) query = query.lte(\"check_in\", to)\r\n\r\n  const { data, error } = await query\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching attendance:\", error)\r\n    return []\r\n  }\r\n\r\n  return data || []\r\n}\r\n\r\nexport async function checkIn() {\r\n  const supabase = await createClient()\r\n\r\n  const { data: { user } } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { data: employee } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"id\")\r\n    .eq(\"user_id\", user.id)\r\n    .single()\r\n\r\n  if (!employee) return { success: false, error: \"Employee not found\" }\r\n\r\n  // Kiểm tra đã check-in hôm nay chưa\r\n  const today = new Date().toISOString().split(\"T\")[0]\r\n  const { data: existing } = await supabase\r\n    .from(\"attendance_logs\")\r\n    .select(\"id\")\r\n    .eq(\"employee_id\", employee.id)\r\n    .gte(\"check_in\", today)\r\n    .lt(\"check_in\", today + \"T23:59:59\")\r\n    .single()\r\n\r\n  if (existing) {\r\n    return { success: false, error: \"Already checked in today\" }\r\n  }\r\n\r\n  const { error } = await supabase.from(\"attendance_logs\").insert({\r\n    employee_id: employee.id,\r\n    check_in: new Date().toISOString(),\r\n    source: \"manual\",\r\n  })\r\n\r\n  if (error) {\r\n    console.error(\"Error checking in:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/attendance\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function checkOut() {\r\n  const supabase = await createClient()\r\n\r\n  const { data: { user } } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { data: employee } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"id\")\r\n    .eq(\"user_id\", user.id)\r\n    .single()\r\n\r\n  if (!employee) return { success: false, error: \"Employee not found\" }\r\n\r\n  // Tìm record check-in hôm nay\r\n  const today = new Date().toISOString().split(\"T\")[0]\r\n  const { data: attendance } = await supabase\r\n    .from(\"attendance_logs\")\r\n    .select(\"id, check_out\")\r\n    .eq(\"employee_id\", employee.id)\r\n    .gte(\"check_in\", today)\r\n    .lt(\"check_in\", today + \"T23:59:59\")\r\n    .single()\r\n\r\n  if (!attendance) {\r\n    return { success: false, error: \"No check-in record found for today\" }\r\n  }\r\n\r\n  if (attendance.check_out) {\r\n    return { success: false, error: \"Already checked out today\" }\r\n  }\r\n\r\n  const { error } = await supabase\r\n    .from(\"attendance_logs\")\r\n    .update({ check_out: new Date().toISOString() })\r\n    .eq(\"id\", attendance.id)\r\n\r\n  if (error) {\r\n    console.error(\"Error checking out:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/attendance\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function listAttendance(filters?: {\r\n  employee_id?: string\r\n  from?: string\r\n  to?: string\r\n}): Promise<AttendanceLogWithRelations[]> {\r\n  const supabase = await createClient()\r\n\r\n  let query = supabase\r\n    .from(\"attendance_logs\")\r\n    .select(`\r\n      *,\r\n      employee:employees(\r\n        id,\r\n        full_name,\r\n        employee_code,\r\n        shift:work_shifts(id, name, start_time, end_time, break_start, break_end, break_minutes)\r\n      )\r\n    `)\r\n    .order(\"check_in\", { ascending: false })\r\n\r\n  if (filters?.employee_id) query = query.eq(\"employee_id\", filters.employee_id)\r\n  if (filters?.from) query = query.gte(\"check_in\", filters.from)\r\n  if (filters?.to) query = query.lte(\"check_in\", filters.to)\r\n\r\n  const { data, error } = await query.limit(100)\r\n\r\n  if (error) {\r\n    console.error(\"Error listing attendance:\", error)\r\n    return []\r\n  }\r\n\r\n  return (data || []) as AttendanceLogWithRelations[]\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;AAEA;AACA;;;;;AAGO,eAAe,gBAAgB,IAAa,EAAE,EAAW;IAC9D,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,IAAI,CAAC,MAAM,OAAO,EAAE;IAEpB,2BAA2B;IAC3B,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,SAC9B,IAAI,CAAC,aACL,MAAM,CAAC,MACP,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,MAAM;IAET,IAAI,CAAC,UAAU,OAAO,EAAE;IAExB,IAAI,QAAQ,SACT,IAAI,CAAC,mBACL,MAAM,CAAC,KACP,EAAE,CAAC,eAAe,SAAS,EAAE,EAC7B,KAAK,CAAC,YAAY;QAAE,WAAW;IAAM;IAExC,IAAI,MAAM,QAAQ,MAAM,GAAG,CAAC,YAAY;IACxC,IAAI,IAAI,QAAQ,MAAM,GAAG,CAAC,YAAY;IAEtC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM;IAE9B,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,EAAE;IACX;IAEA,OAAO,QAAQ,EAAE;AACnB;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,IAAI,CAAC,MAAM,OAAO;QAAE,SAAS;QAAO,OAAO;IAAoB;IAE/D,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,SAC9B,IAAI,CAAC,aACL,MAAM,CAAC,MACP,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,MAAM;IAET,IAAI,CAAC,UAAU,OAAO;QAAE,SAAS;QAAO,OAAO;IAAqB;IAEpE,oCAAoC;IACpC,MAAM,QAAQ,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;IACpD,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,SAC9B,IAAI,CAAC,mBACL,MAAM,CAAC,MACP,EAAE,CAAC,eAAe,SAAS,EAAE,EAC7B,GAAG,CAAC,YAAY,OAChB,EAAE,CAAC,YAAY,QAAQ,aACvB,MAAM;IAET,IAAI,UAAU;QACZ,OAAO;YAAE,SAAS;YAAO,OAAO;QAA2B;IAC7D;IAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,mBAAmB,MAAM,CAAC;QAC9D,aAAa,SAAS,EAAE;QACxB,UAAU,IAAI,OAAO,WAAW;QAChC,QAAQ;IACV;IAEA,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAChD;IAEA,IAAA,+QAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AACzB;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,IAAI,CAAC,MAAM,OAAO;QAAE,SAAS;QAAO,OAAO;IAAoB;IAE/D,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,SAC9B,IAAI,CAAC,aACL,MAAM,CAAC,MACP,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,MAAM;IAET,IAAI,CAAC,UAAU,OAAO;QAAE,SAAS;QAAO,OAAO;IAAqB;IAEpE,8BAA8B;IAC9B,MAAM,QAAQ,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;IACpD,MAAM,EAAE,MAAM,UAAU,EAAE,GAAG,MAAM,SAChC,IAAI,CAAC,mBACL,MAAM,CAAC,iBACP,EAAE,CAAC,eAAe,SAAS,EAAE,EAC7B,GAAG,CAAC,YAAY,OAChB,EAAE,CAAC,YAAY,QAAQ,aACvB,MAAM;IAET,IAAI,CAAC,YAAY;QACf,OAAO;YAAE,SAAS;YAAO,OAAO;QAAqC;IACvE;IAEA,IAAI,WAAW,SAAS,EAAE;QACxB,OAAO;YAAE,SAAS;YAAO,OAAO;QAA4B;IAC9D;IAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SACrB,IAAI,CAAC,mBACL,MAAM,CAAC;QAAE,WAAW,IAAI,OAAO,WAAW;IAAG,GAC7C,EAAE,CAAC,MAAM,WAAW,EAAE;IAEzB,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAChD;IAEA,IAAA,+QAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AACzB;AAEO,eAAe,eAAe,OAIpC;IACC,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,IAAI,QAAQ,SACT,IAAI,CAAC,mBACL,MAAM,CAAC,CAAC;;;;;;;;IAQT,CAAC,EACA,KAAK,CAAC,YAAY;QAAE,WAAW;IAAM;IAExC,IAAI,SAAS,aAAa,QAAQ,MAAM,EAAE,CAAC,eAAe,QAAQ,WAAW;IAC7E,IAAI,SAAS,MAAM,QAAQ,MAAM,GAAG,CAAC,YAAY,QAAQ,IAAI;IAC7D,IAAI,SAAS,IAAI,QAAQ,MAAM,GAAG,CAAC,YAAY,QAAQ,EAAE;IAEzD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,MAAM,KAAK,CAAC;IAE1C,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,EAAE;IACX;IAEA,OAAQ,QAAQ,EAAE;AACpB;;;IA3JsB;IAkCA;IA2CA;IA8CA;;AA3HA,+WAAA;AAkCA,+WAAA;AA2CA,+WAAA;AA8CA,+WAAA"}},
    {"offset": {"line": 447, "column": 0}, "map": {"version":3,"sources":["file:///E:/Pamo/v0-hrm/lib/actions/shift-actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport type { WorkShift } from \"@/lib/types/database\"\r\n\r\nexport async function listWorkShifts(): Promise<WorkShift[]> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase.from(\"work_shifts\").select(\"*\").order(\"name\")\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching work shifts:\", error)\r\n    return []\r\n  }\r\n\r\n  return data || []\r\n}\r\n\r\nexport async function getMyShift(): Promise<WorkShift | null> {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return null\r\n\r\n  const { data: employee } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"shift_id\")\r\n    .eq(\"user_id\", user.id)\r\n    .single()\r\n\r\n  if (!employee?.shift_id) return null\r\n\r\n  const { data: shift } = await supabase\r\n    .from(\"work_shifts\")\r\n    .select(\"*\")\r\n    .eq(\"id\", employee.shift_id)\r\n    .single()\r\n\r\n  return shift || null\r\n}\r\n\r\nexport async function createWorkShift(input: {\r\n  name: string\r\n  start_time: string\r\n  end_time: string\r\n  break_start?: string\r\n  break_end?: string\r\n  break_minutes?: number\r\n}) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase.from(\"work_shifts\").insert({\r\n    name: input.name,\r\n    start_time: input.start_time,\r\n    end_time: input.end_time,\r\n    break_start: input.break_start || null,\r\n    break_end: input.break_end || null,\r\n    break_minutes: input.break_minutes || 0,\r\n  })\r\n\r\n  if (error) {\r\n    console.error(\"Error creating work shift:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/departments\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function updateWorkShift(\r\n  id: string,\r\n  input: {\r\n    name?: string\r\n    start_time?: string\r\n    end_time?: string\r\n    break_start?: string | null\r\n    break_end?: string | null\r\n    break_minutes?: number\r\n  }\r\n) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase.from(\"work_shifts\").update(input).eq(\"id\", id)\r\n\r\n  if (error) {\r\n    console.error(\"Error updating work shift:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/departments\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function deleteWorkShift(id: string) {\r\n  const supabase = await createClient()\r\n\r\n  // Kiểm tra có nhân viên đang dùng ca này không\r\n  const { count } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"*\", { count: \"exact\", head: true })\r\n    .eq(\"shift_id\", id)\r\n\r\n  if (count && count > 0) {\r\n    return { success: false, error: \"Không thể xóa ca làm đang có nhân viên sử dụng\" }\r\n  }\r\n\r\n  const { error } = await supabase.from(\"work_shifts\").delete().eq(\"id\", id)\r\n\r\n  if (error) {\r\n    console.error(\"Error deleting work shift:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/departments\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function assignShiftToEmployee(employeeId: string, shiftId: string | null) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase\r\n    .from(\"employees\")\r\n    .update({ shift_id: shiftId })\r\n    .eq(\"id\", employeeId)\r\n\r\n  if (error) {\r\n    console.error(\"Error assigning shift:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/employees\")\r\n  return { success: true }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 585, "column": 0}, "map": {"version":3,"sources":["file:///E:/Pamo/v0-hrm/.next-internal/server/app/dashboard/attendance/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getMyRoles as '005e20e2e268d812762b030e4aac3b7693066871b6'} from 'ACTIONS_MODULE0'\nexport {getMyEmployee as '00636a7c2e61bd285b975ea815e7fbbefdffae959f'} from 'ACTIONS_MODULE0'\nexport {listEmployees as '00b0c7f0352396833a3aa70b738bb3a8c2a485efae'} from 'ACTIONS_MODULE0'\nexport {createEmployee as '4072cdebcca1df607d08f62096843ddf91d2cf29f6'} from 'ACTIONS_MODULE0'\nexport {updateMyProfile as '407a7f2085358134fb9b61998dbd9fa880ad52c2cf'} from 'ACTIONS_MODULE0'\nexport {getEmployee as '409df3c5b25ea33596f872aab0b186da47271a8e80'} from 'ACTIONS_MODULE0'\nexport {updateEmployee as '60e7529b55507157f11112b5c625757ac226a23a7c'} from 'ACTIONS_MODULE0'\nexport {changeDepartment as '701419c868154523741dd2880ac65e97064ceb8620'} from 'ACTIONS_MODULE0'\nexport {changePosition as '70daddb01ea9f495d095baa024616ddfa6ee94f8dd'} from 'ACTIONS_MODULE0'\nexport {checkIn as '0044def5c4ae00c73cee8246f37e5c7f31cfa1b92b'} from 'ACTIONS_MODULE1'\nexport {checkOut as '00d6231afa02148cee00d77c2e86cbcfcacd6e0be0'} from 'ACTIONS_MODULE1'\nexport {listAttendance as '4040e9b328525a1ddf3e601b33e8a598a808f94e5e'} from 'ACTIONS_MODULE1'\nexport {getMyAttendance as '602bd54b668a505e0fd8670b012befb376511d9937'} from 'ACTIONS_MODULE1'\nexport {listWorkShifts as '002f9d6345a5a511f01152040fcd0fa52b4139fa39'} from 'ACTIONS_MODULE2'\nexport {getMyShift as '00cff4a0838b0d5761bdee4b5a75d0a5299141c758'} from 'ACTIONS_MODULE2'\nexport {createWorkShift as '4087a37486892d33a9d94464ac3eea2cae1a6c9704'} from 'ACTIONS_MODULE2'\nexport {deleteWorkShift as '40f0914397b5f127d767a7e9a05d4d194efbe4f8c0'} from 'ACTIONS_MODULE2'\nexport {assignShiftToEmployee as '60bda9c7aba221f5c86fe1b4c9f7767110548a0047'} from 'ACTIONS_MODULE2'\nexport {updateWorkShift as '60fdca0f6d3ab43d79126edcb587d20015a30b4bda'} from 'ACTIONS_MODULE2'\nexport {checkIn as '0044def5c4ae00c73cee8246f37e5c7f31cfa1b92b'} from 'ACTIONS_MODULE1'\nexport {checkOut as '00d6231afa02148cee00d77c2e86cbcfcacd6e0be0'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AASA;AAIA"}}]
}