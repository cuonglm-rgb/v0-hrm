{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/Pamo/v0-hrm/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\r\nimport { cookies } from \"next/headers\"\r\n\r\nexport async function createClient() {\r\n  const cookieStore = await cookies()\r\n\r\n  return createServerClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!, {\r\n    cookies: {\r\n      getAll() {\r\n        return cookieStore.getAll()\r\n      },\r\n      setAll(cookiesToSet) {\r\n        try {\r\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\r\n        } catch {\r\n          // The \"setAll\" method was called from a Server Component.\r\n          // This can be ignored if you have proxy refreshing user sessions.\r\n        }\r\n      },\r\n    },\r\n  })\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0QAAO;IAEjC,OAAO,IAAA,4SAAkB,oKAAoF;QAC3G,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,kEAAkE;gBACpE;YACF;QACF;IACF;AACF"}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///E:/Pamo/v0-hrm/lib/actions/employee-actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport type { Employee, EmployeeWithRelations, UserRoleWithRelations } from \"@/lib/types/database\"\r\n\r\nexport async function getMyEmployee(): Promise<EmployeeWithRelations | null> {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return null\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"employees\")\r\n    .select(`\r\n      *,\r\n      department:departments(*),\r\n      position:positions(*),\r\n      manager:employees!manager_id(id, full_name, email)\r\n    `)\r\n    .eq(\"user_id\", user.id)\r\n    .single()\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching employee:\", error)\r\n    return null\r\n  }\r\n\r\n  return data as EmployeeWithRelations\r\n}\r\n\r\nexport async function getMyRoles(): Promise<UserRoleWithRelations[]> {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return []\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"user_roles\")\r\n    .select(`\r\n      *,\r\n      role:roles(*)\r\n    `)\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching roles:\", error)\r\n    return []\r\n  }\r\n\r\n  return (data || []) as UserRoleWithRelations[]\r\n}\r\n\r\nexport async function listEmployees(): Promise<EmployeeWithRelations[]> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"employees\")\r\n    .select(`\r\n      *,\r\n      department:departments(*),\r\n      position:positions(*)\r\n    `)\r\n    .order(\"created_at\", { ascending: false })\r\n\r\n  if (error) {\r\n    console.error(\"Error listing employees:\", error)\r\n    return []\r\n  }\r\n\r\n  return (data || []) as EmployeeWithRelations[]\r\n}\r\n\r\nexport async function getEmployee(id: string): Promise<EmployeeWithRelations | null> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"employees\")\r\n    .select(`\r\n      *,\r\n      department:departments(*),\r\n      position:positions(*),\r\n      manager:employees!manager_id(id, full_name, email),\r\n      shift:work_shifts(*)\r\n    `)\r\n    .eq(\"id\", id)\r\n    .single()\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching employee:\", error)\r\n    return null\r\n  }\r\n\r\n  return data as EmployeeWithRelations\r\n}\r\n\r\nexport async function updateEmployee(\r\n  id: string,\r\n  data: Partial<Pick<Employee, \"full_name\" | \"phone\" | \"department_id\" | \"position_id\" | \"shift_id\" | \"status\" | \"join_date\">>,\r\n) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase\r\n    .from(\"employees\")\r\n    .update({ ...data, updated_at: new Date().toISOString() })\r\n    .eq(\"id\", id)\r\n\r\n  if (error) {\r\n    console.error(\"Error updating employee:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/employees\")\r\n  revalidatePath(`/dashboard/employees/${id}`)\r\n  return { success: true }\r\n}\r\n\r\nexport async function updateMyProfile(data: Partial<Pick<Employee, \"full_name\" | \"phone\">>) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Not authenticated\" }\r\n\r\n  const { error } = await supabase\r\n    .from(\"employees\")\r\n    .update({ ...data, updated_at: new Date().toISOString() })\r\n    .eq(\"user_id\", user.id)\r\n\r\n  if (error) {\r\n    console.error(\"Error updating profile:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/profile\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function createEmployee(data: {\r\n  full_name: string\r\n  email: string\r\n  phone?: string | null\r\n  department_id?: string | null\r\n  position_id?: string | null\r\n  join_date?: string | null\r\n}) {\r\n  const supabase = await createClient()\r\n\r\n  // Generate employee code\r\n  const code = `NV${new Date().toISOString().slice(0, 7).replace(\"-\", \"\")}${Math.floor(Math.random() * 10000)\r\n    .toString()\r\n    .padStart(4, \"0\")}`\r\n\r\n  const { error } = await supabase.from(\"employees\").insert({\r\n    employee_code: code,\r\n    full_name: data.full_name,\r\n    email: data.email,\r\n    phone: data.phone,\r\n    department_id: data.department_id,\r\n    position_id: data.position_id,\r\n    join_date: data.join_date,\r\n    status: \"onboarding\",\r\n  })\r\n\r\n  if (error) {\r\n    console.error(\"Error creating employee:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/employees\")\r\n  return { success: true }\r\n}\r\n\r\n// Đổi phòng ban + lưu lịch sử\r\nexport async function changeDepartment(\r\n  employeeId: string,\r\n  newDepartmentId: string,\r\n  salary?: number\r\n) {\r\n  const supabase = await createClient()\r\n\r\n  // Lấy thông tin hiện tại\r\n  const { data: employee } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"department_id, position_id\")\r\n    .eq(\"id\", employeeId)\r\n    .single()\r\n\r\n  if (!employee) return { success: false, error: \"Employee not found\" }\r\n\r\n  const today = new Date().toISOString().split(\"T\")[0]\r\n\r\n  // Đóng record lịch sử cũ\r\n  await supabase\r\n    .from(\"employee_job_history\")\r\n    .update({ end_date: today })\r\n    .eq(\"employee_id\", employeeId)\r\n    .is(\"end_date\", null)\r\n\r\n  // Tạo record lịch sử mới\r\n  await supabase.from(\"employee_job_history\").insert({\r\n    employee_id: employeeId,\r\n    department_id: newDepartmentId,\r\n    position_id: employee.position_id,\r\n    salary: salary || null,\r\n    start_date: today,\r\n  })\r\n\r\n  // Update employee\r\n  const { error } = await supabase\r\n    .from(\"employees\")\r\n    .update({ department_id: newDepartmentId, updated_at: new Date().toISOString() })\r\n    .eq(\"id\", employeeId)\r\n\r\n  if (error) {\r\n    console.error(\"Error changing department:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/employees\")\r\n  revalidatePath(`/dashboard/employees/${employeeId}`)\r\n  return { success: true }\r\n}\r\n\r\n// Đổi chức vụ + lưu lịch sử\r\nexport async function changePosition(\r\n  employeeId: string,\r\n  newPositionId: string,\r\n  salary?: number\r\n) {\r\n  const supabase = await createClient()\r\n\r\n  // Lấy thông tin hiện tại\r\n  const { data: employee } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"department_id, position_id\")\r\n    .eq(\"id\", employeeId)\r\n    .single()\r\n\r\n  if (!employee) return { success: false, error: \"Employee not found\" }\r\n\r\n  const today = new Date().toISOString().split(\"T\")[0]\r\n\r\n  // Đóng record lịch sử cũ\r\n  await supabase\r\n    .from(\"employee_job_history\")\r\n    .update({ end_date: today })\r\n    .eq(\"employee_id\", employeeId)\r\n    .is(\"end_date\", null)\r\n\r\n  // Tạo record lịch sử mới\r\n  await supabase.from(\"employee_job_history\").insert({\r\n    employee_id: employeeId,\r\n    department_id: employee.department_id,\r\n    position_id: newPositionId,\r\n    salary: salary || null,\r\n    start_date: today,\r\n  })\r\n\r\n  // Update employee\r\n  const { error } = await supabase\r\n    .from(\"employees\")\r\n    .update({ position_id: newPositionId, updated_at: new Date().toISOString() })\r\n    .eq(\"id\", employeeId)\r\n\r\n  if (error) {\r\n    console.error(\"Error changing position:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/employees\")\r\n  revalidatePath(`/dashboard/employees/${employeeId}`)\r\n  return { success: true }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 293, "column": 0}, "map": {"version":3,"sources":["file:///E:/Pamo/v0-hrm/lib/actions/department-actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport type { Department, Position } from \"@/lib/types/database\"\r\n\r\nexport async function listDepartments(): Promise<Department[]> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase.from(\"departments\").select(\"*\").order(\"name\")\r\n\r\n  if (error) {\r\n    console.error(\"Error listing departments:\", error)\r\n    return []\r\n  }\r\n\r\n  return data || []\r\n}\r\n\r\nexport async function listPositions(): Promise<Position[]> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase.from(\"positions\").select(\"*\").order(\"level\", { ascending: false })\r\n\r\n  if (error) {\r\n    console.error(\"Error listing positions:\", error)\r\n    return []\r\n  }\r\n\r\n  return data || []\r\n}\r\n\r\nexport async function createDepartment(data: { name: string; code?: string; parent_id?: string }) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase.from(\"departments\").insert(data)\r\n\r\n  if (error) {\r\n    console.error(\"Error creating department:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/departments\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function updateDepartment(id: string, data: { name?: string; code?: string; parent_id?: string | null }) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase.from(\"departments\").update(data).eq(\"id\", id)\r\n\r\n  if (error) {\r\n    console.error(\"Error updating department:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/departments\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function deleteDepartment(id: string) {\r\n  const supabase = await createClient()\r\n\r\n  // Kiểm tra có nhân viên trong phòng ban không\r\n  const { count } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"*\", { count: \"exact\", head: true })\r\n    .eq(\"department_id\", id)\r\n\r\n  if (count && count > 0) {\r\n    return { success: false, error: \"Không thể xóa phòng ban đang có nhân viên\" }\r\n  }\r\n\r\n  const { error } = await supabase.from(\"departments\").delete().eq(\"id\", id)\r\n\r\n  if (error) {\r\n    console.error(\"Error deleting department:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/departments\")\r\n  return { success: true }\r\n}\r\n\r\n// =============================================\r\n// POSITION ACTIONS\r\n// =============================================\r\n\r\nexport async function createPosition(data: { name: string; level: number }) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase.from(\"positions\").insert(data)\r\n\r\n  if (error) {\r\n    console.error(\"Error creating position:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/departments\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function updatePosition(id: string, data: { name?: string; level?: number }) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase.from(\"positions\").update(data).eq(\"id\", id)\r\n\r\n  if (error) {\r\n    console.error(\"Error updating position:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/departments\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function deletePosition(id: string) {\r\n  const supabase = await createClient()\r\n\r\n  // Kiểm tra có nhân viên đang giữ vị trí này không\r\n  const { count } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"*\", { count: \"exact\", head: true })\r\n    .eq(\"position_id\", id)\r\n\r\n  if (count && count > 0) {\r\n    return { success: false, error: \"Không thể xóa vị trí đang có nhân viên\" }\r\n  }\r\n\r\n  const { error } = await supabase.from(\"positions\").delete().eq(\"id\", id)\r\n\r\n  if (error) {\r\n    console.error(\"Error deleting position:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/departments\")\r\n  return { success: true }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 473, "column": 0}, "map": {"version":3,"sources":["file:///E:/Pamo/v0-hrm/lib/actions/shift-actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport type { WorkShift } from \"@/lib/types/database\"\r\n\r\nexport async function listWorkShifts(): Promise<WorkShift[]> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase.from(\"work_shifts\").select(\"*\").order(\"name\")\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching work shifts:\", error)\r\n    return []\r\n  }\r\n\r\n  return data || []\r\n}\r\n\r\nexport async function getMyShift(): Promise<WorkShift | null> {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return null\r\n\r\n  const { data: employee } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"shift_id\")\r\n    .eq(\"user_id\", user.id)\r\n    .single()\r\n\r\n  if (!employee?.shift_id) return null\r\n\r\n  const { data: shift } = await supabase\r\n    .from(\"work_shifts\")\r\n    .select(\"*\")\r\n    .eq(\"id\", employee.shift_id)\r\n    .single()\r\n\r\n  return shift || null\r\n}\r\n\r\nexport async function createWorkShift(input: {\r\n  name: string\r\n  start_time: string\r\n  end_time: string\r\n  break_start?: string\r\n  break_end?: string\r\n  break_minutes?: number\r\n}) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase.from(\"work_shifts\").insert({\r\n    name: input.name,\r\n    start_time: input.start_time,\r\n    end_time: input.end_time,\r\n    break_start: input.break_start || null,\r\n    break_end: input.break_end || null,\r\n    break_minutes: input.break_minutes || 0,\r\n  })\r\n\r\n  if (error) {\r\n    console.error(\"Error creating work shift:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/departments\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function updateWorkShift(\r\n  id: string,\r\n  input: {\r\n    name?: string\r\n    start_time?: string\r\n    end_time?: string\r\n    break_start?: string | null\r\n    break_end?: string | null\r\n    break_minutes?: number\r\n  }\r\n) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase.from(\"work_shifts\").update(input).eq(\"id\", id)\r\n\r\n  if (error) {\r\n    console.error(\"Error updating work shift:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/departments\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function deleteWorkShift(id: string) {\r\n  const supabase = await createClient()\r\n\r\n  // Kiểm tra có nhân viên đang dùng ca này không\r\n  const { count } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"*\", { count: \"exact\", head: true })\r\n    .eq(\"shift_id\", id)\r\n\r\n  if (count && count > 0) {\r\n    return { success: false, error: \"Không thể xóa ca làm đang có nhân viên sử dụng\" }\r\n  }\r\n\r\n  const { error } = await supabase.from(\"work_shifts\").delete().eq(\"id\", id)\r\n\r\n  if (error) {\r\n    console.error(\"Error deleting work shift:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/departments\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function assignShiftToEmployee(employeeId: string, shiftId: string | null) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase\r\n    .from(\"employees\")\r\n    .update({ shift_id: shiftId })\r\n    .eq(\"id\", employeeId)\r\n\r\n  if (error) {\r\n    console.error(\"Error assigning shift:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/employees\")\r\n  return { success: true }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAEA;AACA;;;;;AAGO,eAAe;IACpB,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,eAAe,MAAM,CAAC,KAAK,KAAK,CAAC;IAE7E,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,EAAE;IACX;IAEA,OAAO,QAAQ,EAAE;AACnB;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAC/B,IAAI,CAAC,MAAM,OAAO;IAElB,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,SAC9B,IAAI,CAAC,aACL,MAAM,CAAC,YACP,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,MAAM;IAET,IAAI,CAAC,UAAU,UAAU,OAAO;IAEhC,MAAM,EAAE,MAAM,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,eACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,SAAS,QAAQ,EAC1B,MAAM;IAET,OAAO,SAAS;AAClB;AAEO,eAAe,gBAAgB,KAOrC;IACC,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,eAAe,MAAM,CAAC;QAC1D,MAAM,MAAM,IAAI;QAChB,YAAY,MAAM,UAAU;QAC5B,UAAU,MAAM,QAAQ;QACxB,aAAa,MAAM,WAAW,IAAI;QAClC,WAAW,MAAM,SAAS,IAAI;QAC9B,eAAe,MAAM,aAAa,IAAI;IACxC;IAEA,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAChD;IAEA,IAAA,+QAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AACzB;AAEO,eAAe,gBACpB,EAAU,EACV,KAOC;IAED,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,eAAe,MAAM,CAAC,OAAO,EAAE,CAAC,MAAM;IAE5E,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAChD;IAEA,IAAA,+QAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AACzB;AAEO,eAAe,gBAAgB,EAAU;IAC9C,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,+CAA+C;IAC/C,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SACrB,IAAI,CAAC,aACL,MAAM,CAAC,KAAK;QAAE,OAAO;QAAS,MAAM;IAAK,GACzC,EAAE,CAAC,YAAY;IAElB,IAAI,SAAS,QAAQ,GAAG;QACtB,OAAO;YAAE,SAAS;YAAO,OAAO;QAAiD;IACnF;IAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,eAAe,MAAM,GAAG,EAAE,CAAC,MAAM;IAEvE,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAChD;IAEA,IAAA,+QAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AACzB;AAEO,eAAe,sBAAsB,UAAkB,EAAE,OAAsB;IACpF,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SACrB,IAAI,CAAC,aACL,MAAM,CAAC;QAAE,UAAU;IAAQ,GAC3B,EAAE,CAAC,MAAM;IAEZ,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAChD;IAEA,IAAA,+QAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AACzB;;;IAjIsB;IAaA;IAyBA;IA4BA;IAwBA;IAwBA;;AAlHA,+WAAA;AAaA,+WAAA;AAyBA,+WAAA;AA4BA,+WAAA;AAwBA,+WAAA;AAwBA,+WAAA"}},
    {"offset": {"line": 611, "column": 0}, "map": {"version":3,"sources":["file:///E:/Pamo/v0-hrm/lib/actions/role-actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport type { Role, RoleCode } from \"@/lib/types/database\"\r\n\r\nexport async function listRoles(): Promise<Role[]> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase.from(\"roles\").select(\"*\").order(\"name\")\r\n\r\n  if (error) {\r\n    console.error(\"Error listing roles:\", error)\r\n    return []\r\n  }\r\n\r\n  return data || []\r\n}\r\n\r\nexport async function assignRole(userId: string, roleCode: RoleCode, departmentId?: string) {\r\n  const supabase = await createClient()\r\n\r\n  // Get role id from code\r\n  const { data: role } = await supabase.from(\"roles\").select(\"id\").eq(\"code\", roleCode).single()\r\n\r\n  if (!role) {\r\n    return { success: false, error: \"Role not found\" }\r\n  }\r\n\r\n  const { error } = await supabase.from(\"user_roles\").upsert(\r\n    {\r\n      user_id: userId,\r\n      role_id: role.id,\r\n      department_id: departmentId || null,\r\n    },\r\n    {\r\n      onConflict: \"user_id,role_id\",\r\n    },\r\n  )\r\n\r\n  if (error) {\r\n    console.error(\"Error assigning role:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/employees\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function removeRole(userId: string, roleCode: RoleCode) {\r\n  const supabase = await createClient()\r\n\r\n  // Get role id from code\r\n  const { data: role } = await supabase.from(\"roles\").select(\"id\").eq(\"code\", roleCode).single()\r\n\r\n  if (!role) {\r\n    return { success: false, error: \"Role not found\" }\r\n  }\r\n\r\n  const { error } = await supabase.from(\"user_roles\").delete().eq(\"user_id\", userId).eq(\"role_id\", role.id)\r\n\r\n  if (error) {\r\n    console.error(\"Error removing role:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/employees\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function getUserRoles(userId: string) {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"user_roles\")\r\n    .select(`\r\n      *,\r\n      role:roles(*)\r\n    `)\r\n    .eq(\"user_id\", userId)\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching user roles:\", error)\r\n    return []\r\n  }\r\n\r\n  return data || []\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;AAEA;AACA;;;;;AAGO,eAAe;IACpB,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,SAAS,MAAM,CAAC,KAAK,KAAK,CAAC;IAEvE,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,EAAE;IACX;IAEA,OAAO,QAAQ,EAAE;AACnB;AAEO,eAAe,WAAW,MAAc,EAAE,QAAkB,EAAE,YAAqB;IACxF,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,wBAAwB;IACxB,MAAM,EAAE,MAAM,IAAI,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,SAAS,MAAM,CAAC,MAAM,EAAE,CAAC,QAAQ,UAAU,MAAM;IAE5F,IAAI,CAAC,MAAM;QACT,OAAO;YAAE,SAAS;YAAO,OAAO;QAAiB;IACnD;IAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,cAAc,MAAM,CACxD;QACE,SAAS;QACT,SAAS,KAAK,EAAE;QAChB,eAAe,gBAAgB;IACjC,GACA;QACE,YAAY;IACd;IAGF,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAChD;IAEA,IAAA,+QAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AACzB;AAEO,eAAe,WAAW,MAAc,EAAE,QAAkB;IACjE,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,wBAAwB;IACxB,MAAM,EAAE,MAAM,IAAI,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,SAAS,MAAM,CAAC,MAAM,EAAE,CAAC,QAAQ,UAAU,MAAM;IAE5F,IAAI,CAAC,MAAM;QACT,OAAO;YAAE,SAAS;YAAO,OAAO;QAAiB;IACnD;IAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,cAAc,MAAM,GAAG,EAAE,CAAC,WAAW,QAAQ,EAAE,CAAC,WAAW,KAAK,EAAE;IAExG,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAChD;IAEA,IAAA,+QAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AACzB;AAEO,eAAe,aAAa,MAAc;IAC/C,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,cACL,MAAM,CAAC,CAAC;;;IAGT,CAAC,EACA,EAAE,CAAC,WAAW;IAEjB,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,EAAE;IACX;IAEA,OAAO,QAAQ,EAAE;AACnB;;;IAjFsB;IAaA;IA8BA;IAqBA;;AAhEA,+WAAA;AAaA,+WAAA;AA8BA,+WAAA;AAqBA,+WAAA"}},
    {"offset": {"line": 716, "column": 0}, "map": {"version":3,"sources":["file:///E:/Pamo/v0-hrm/lib/actions/job-history-actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport type { EmployeeJobHistory, EmployeeJobHistoryWithRelations } from \"@/lib/types/database\"\r\n\r\nexport async function getMyJobHistory(): Promise<EmployeeJobHistoryWithRelations[]> {\r\n  const supabase = await createClient()\r\n\r\n  const { data: { user } } = await supabase.auth.getUser()\r\n  if (!user) return []\r\n\r\n  const { data: employee } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"id\")\r\n    .eq(\"user_id\", user.id)\r\n    .single()\r\n\r\n  if (!employee) return []\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"employee_job_history\")\r\n    .select(`\r\n      *,\r\n      department:departments(*),\r\n      position:positions(*)\r\n    `)\r\n    .eq(\"employee_id\", employee.id)\r\n    .order(\"start_date\", { ascending: false })\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching job history:\", error)\r\n    return []\r\n  }\r\n\r\n  return (data || []) as EmployeeJobHistoryWithRelations[]\r\n}\r\n\r\nexport async function getEmployeeJobHistory(employee_id: string): Promise<EmployeeJobHistoryWithRelations[]> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"employee_job_history\")\r\n    .select(`\r\n      *,\r\n      department:departments(*),\r\n      position:positions(*)\r\n    `)\r\n    .eq(\"employee_id\", employee_id)\r\n    .order(\"start_date\", { ascending: false })\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching job history:\", error)\r\n    return []\r\n  }\r\n\r\n  return (data || []) as EmployeeJobHistoryWithRelations[]\r\n}\r\n\r\nexport async function createJobHistory(input: {\r\n  employee_id: string\r\n  department_id?: string | null\r\n  position_id?: string | null\r\n  salary?: number | null\r\n  start_date: string\r\n  end_date?: string | null\r\n}) {\r\n  const supabase = await createClient()\r\n\r\n  // Đóng record cũ nếu có\r\n  if (!input.end_date) {\r\n    await supabase\r\n      .from(\"employee_job_history\")\r\n      .update({ end_date: input.start_date })\r\n      .eq(\"employee_id\", input.employee_id)\r\n      .is(\"end_date\", null)\r\n  }\r\n\r\n  const { error } = await supabase.from(\"employee_job_history\").insert({\r\n    employee_id: input.employee_id,\r\n    department_id: input.department_id,\r\n    position_id: input.position_id,\r\n    salary: input.salary,\r\n    start_date: input.start_date,\r\n    end_date: input.end_date,\r\n  })\r\n\r\n  if (error) {\r\n    console.error(\"Error creating job history:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(`/dashboard/employees/${input.employee_id}`)\r\n  return { success: true }\r\n}\r\n\r\nexport async function updateJobHistory(\r\n  id: string,\r\n  data: Partial<Pick<EmployeeJobHistory, \"department_id\" | \"position_id\" | \"salary\" | \"start_date\" | \"end_date\">>\r\n) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase\r\n    .from(\"employee_job_history\")\r\n    .update(data)\r\n    .eq(\"id\", id)\r\n\r\n  if (error) {\r\n    console.error(\"Error updating job history:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/employees\")\r\n  return { success: true }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;AAEA;AACA;;;;;AAGO,eAAe;IACpB,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,IAAI,CAAC,MAAM,OAAO,EAAE;IAEpB,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,SAC9B,IAAI,CAAC,aACL,MAAM,CAAC,MACP,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,MAAM;IAET,IAAI,CAAC,UAAU,OAAO,EAAE;IAExB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,wBACL,MAAM,CAAC,CAAC;;;;IAIT,CAAC,EACA,EAAE,CAAC,eAAe,SAAS,EAAE,EAC7B,KAAK,CAAC,cAAc;QAAE,WAAW;IAAM;IAE1C,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,EAAE;IACX;IAEA,OAAQ,QAAQ,EAAE;AACpB;AAEO,eAAe,sBAAsB,WAAmB;IAC7D,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,wBACL,MAAM,CAAC,CAAC;;;;IAIT,CAAC,EACA,EAAE,CAAC,eAAe,aAClB,KAAK,CAAC,cAAc;QAAE,WAAW;IAAM;IAE1C,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,EAAE;IACX;IAEA,OAAQ,QAAQ,EAAE;AACpB;AAEO,eAAe,iBAAiB,KAOtC;IACC,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,wBAAwB;IACxB,IAAI,CAAC,MAAM,QAAQ,EAAE;QACnB,MAAM,SACH,IAAI,CAAC,wBACL,MAAM,CAAC;YAAE,UAAU,MAAM,UAAU;QAAC,GACpC,EAAE,CAAC,eAAe,MAAM,WAAW,EACnC,EAAE,CAAC,YAAY;IACpB;IAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,wBAAwB,MAAM,CAAC;QACnE,aAAa,MAAM,WAAW;QAC9B,eAAe,MAAM,aAAa;QAClC,aAAa,MAAM,WAAW;QAC9B,QAAQ,MAAM,MAAM;QACpB,YAAY,MAAM,UAAU;QAC5B,UAAU,MAAM,QAAQ;IAC1B;IAEA,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAChD;IAEA,IAAA,+QAAc,EAAC,CAAC,qBAAqB,EAAE,MAAM,WAAW,EAAE;IAC1D,OAAO;QAAE,SAAS;IAAK;AACzB;AAEO,eAAe,iBACpB,EAAU,EACV,IAA+G;IAE/G,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SACrB,IAAI,CAAC,wBACL,MAAM,CAAC,MACP,EAAE,CAAC,MAAM;IAEZ,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAChD;IAEA,IAAA,+QAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AACzB;;;IA5GsB;IAgCA;IAqBA;IAqCA;;AA1FA,+WAAA;AAgCA,+WAAA;AAqBA,+WAAA;AAqCA,+WAAA"}},
    {"offset": {"line": 825, "column": 0}, "map": {"version":3,"sources":["file:///E:/Pamo/v0-hrm/lib/actions/payroll-actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport type {\r\n  PayrollRun,\r\n  PayrollItemWithRelations,\r\n  SalaryStructure,\r\n  PayrollAdjustmentType,\r\n} from \"@/lib/types/database\"\r\n\r\nconst STANDARD_WORKING_DAYS = 26 // Công chuẩn VN\r\n\r\n// =============================================\r\n// EMPLOYEE ACTIONS\r\n// =============================================\r\n\r\nexport async function getMyPayslips(): Promise<PayrollItemWithRelations[]> {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return []\r\n\r\n  const { data: employee } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"id\")\r\n    .eq(\"user_id\", user.id)\r\n    .single()\r\n\r\n  if (!employee) return []\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"payroll_items\")\r\n    .select(\r\n      `\r\n      *,\r\n      payroll_run:payroll_runs(*)\r\n    `\r\n    )\r\n    .eq(\"employee_id\", employee.id)\r\n    .order(\"created_at\", { ascending: false })\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching payslips:\", error)\r\n    return []\r\n  }\r\n\r\n  return (data || []) as PayrollItemWithRelations[]\r\n}\r\n\r\n// =============================================\r\n// HR ACTIONS - PAYROLL RUNS\r\n// =============================================\r\n\r\nexport async function listPayrollRuns(): Promise<PayrollRun[]> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"payroll_runs\")\r\n    .select(\"*\")\r\n    .order(\"year\", { ascending: false })\r\n    .order(\"month\", { ascending: false })\r\n\r\n  if (error) {\r\n    console.error(\"Error listing payroll runs:\", error)\r\n    return []\r\n  }\r\n\r\n  return data || []\r\n}\r\n\r\nexport async function getPayrollRun(id: string): Promise<PayrollRun | null> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"payroll_runs\")\r\n    .select(\"*\")\r\n    .eq(\"id\", id)\r\n    .single()\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching payroll run:\", error)\r\n    return null\r\n  }\r\n\r\n  return data\r\n}\r\n\r\nexport async function getPayrollItems(\r\n  payroll_run_id: string\r\n): Promise<PayrollItemWithRelations[]> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"payroll_items\")\r\n    .select(\r\n      `\r\n      *,\r\n      employee:employees(id, full_name, employee_code, department_id, department:departments(name))\r\n    `\r\n    )\r\n    .eq(\"payroll_run_id\", payroll_run_id)\r\n    .order(\"created_at\", { ascending: true })\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching payroll items:\", error)\r\n    return []\r\n  }\r\n\r\n  return (data || []) as PayrollItemWithRelations[]\r\n}\r\n\r\n// =============================================\r\n// HR ACTIONS - GENERATE PAYROLL (với phụ cấp, quỹ, phạt)\r\n// =============================================\r\n\r\ninterface AttendanceViolation {\r\n  date: string\r\n  lateMinutes: number\r\n  earlyMinutes: number\r\n  hasApprovedRequest: boolean\r\n}\r\n\r\nasync function getEmployeeViolations(\r\n  supabase: any,\r\n  employeeId: string,\r\n  startDate: string,\r\n  endDate: string,\r\n  shiftStartTime: string\r\n): Promise<AttendanceViolation[]> {\r\n  const violations: AttendanceViolation[] = []\r\n\r\n  // Lấy attendance logs\r\n  const { data: logs } = await supabase\r\n    .from(\"attendance_logs\")\r\n    .select(\"check_in, check_out\")\r\n    .eq(\"employee_id\", employeeId)\r\n    .gte(\"check_in\", startDate)\r\n    .lte(\"check_in\", endDate + \"T23:59:59\")\r\n\r\n  // Lấy time adjustment requests đã approved\r\n  const { data: approvedRequests } = await supabase\r\n    .from(\"time_adjustment_requests\")\r\n    .select(\"request_date\")\r\n    .eq(\"employee_id\", employeeId)\r\n    .eq(\"status\", \"approved\")\r\n    .gte(\"request_date\", startDate)\r\n    .lte(\"request_date\", endDate)\r\n\r\n  const approvedDates = new Set((approvedRequests || []).map((r: any) => r.request_date))\r\n\r\n  if (logs) {\r\n    const [shiftH, shiftM] = shiftStartTime.split(\":\").map(Number)\r\n    const shiftMinutes = shiftH * 60 + shiftM\r\n\r\n    for (const log of logs) {\r\n      if (!log.check_in) continue\r\n\r\n      const checkInDate = new Date(log.check_in)\r\n      const dateStr = checkInDate.toISOString().split(\"T\")[0]\r\n      const checkInHour = checkInDate.getHours()\r\n      const checkInMin = checkInDate.getMinutes()\r\n      const checkInMinutes = checkInHour * 60 + checkInMin\r\n\r\n      const lateMinutes = Math.max(0, checkInMinutes - shiftMinutes)\r\n\r\n      violations.push({\r\n        date: dateStr,\r\n        lateMinutes,\r\n        earlyMinutes: 0, // TODO: tính về sớm nếu cần\r\n        hasApprovedRequest: approvedDates.has(dateStr),\r\n      })\r\n    }\r\n  }\r\n\r\n  return violations\r\n}\r\n\r\nexport async function generatePayroll(month: number, year: number) {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return { success: false, error: \"Chưa đăng nhập\" }\r\n\r\n  // Kiểm tra đã có payroll run chưa\r\n  const { data: existingRun } = await supabase\r\n    .from(\"payroll_runs\")\r\n    .select(\"id, status\")\r\n    .eq(\"month\", month)\r\n    .eq(\"year\", year)\r\n    .single()\r\n\r\n  if (existingRun) {\r\n    if (existingRun.status !== \"draft\") {\r\n      return { success: false, error: \"Bảng lương tháng này đã khóa, không thể tạo lại\" }\r\n    }\r\n    // Xóa payroll items và adjustment details cũ\r\n    await supabase.from(\"payroll_adjustment_details\").delete().in(\r\n      \"payroll_item_id\",\r\n      (await supabase.from(\"payroll_items\").select(\"id\").eq(\"payroll_run_id\", existingRun.id)).data?.map((i: any) => i.id) || []\r\n    )\r\n    await supabase.from(\"payroll_items\").delete().eq(\"payroll_run_id\", existingRun.id)\r\n    await supabase.from(\"payroll_runs\").delete().eq(\"id\", existingRun.id)\r\n  }\r\n\r\n  // Tạo payroll run mới\r\n  const { data: run, error: runError } = await supabase\r\n    .from(\"payroll_runs\")\r\n    .insert({\r\n      month,\r\n      year,\r\n      status: \"draft\",\r\n      created_by: user.id,\r\n    })\r\n    .select()\r\n    .single()\r\n\r\n  if (runError) {\r\n    console.error(\"Error creating payroll run:\", runError)\r\n    return { success: false, error: runError.message }\r\n  }\r\n\r\n  // Lấy danh sách nhân viên active hoặc onboarding\r\n  const { data: employees, error: empError } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"id, full_name, employee_code, shift_id\")\r\n    .in(\"status\", [\"active\", \"onboarding\"])\r\n\r\n  if (empError || !employees || employees.length === 0) {\r\n    return { success: false, error: \"Không có nhân viên. Vui lòng kiểm tra trạng thái nhân viên.\" }\r\n  }\r\n\r\n  // Lấy các loại điều chỉnh active\r\n  const { data: adjustmentTypes } = await supabase\r\n    .from(\"payroll_adjustment_types\")\r\n    .select(\"*\")\r\n    .eq(\"is_active\", true)\r\n\r\n  // Lấy work shifts\r\n  const { data: shifts } = await supabase.from(\"work_shifts\").select(\"*\")\r\n  const shiftMap = new Map((shifts || []).map((s: any) => [s.id, s]))\r\n\r\n  // Tính ngày đầu và cuối tháng\r\n  const startDate = `${year}-${String(month).padStart(2, \"0\")}-01`\r\n  const endDate = new Date(year, month, 0).toISOString().split(\"T\")[0]\r\n\r\n  let processedCount = 0\r\n  for (const emp of employees) {\r\n    // Lấy lương hiệu lực\r\n    const { data: salary } = await supabase\r\n      .from(\"salary_structure\")\r\n      .select(\"*\")\r\n      .eq(\"employee_id\", emp.id)\r\n      .lte(\"effective_date\", endDate)\r\n      .order(\"effective_date\", { ascending: false })\r\n      .limit(1)\r\n      .maybeSingle()\r\n\r\n    const baseSalary = salary?.base_salary || 0\r\n    const salaryAllowance = salary?.allowance || 0\r\n    const dailySalary = baseSalary / STANDARD_WORKING_DAYS\r\n\r\n    // Đếm ngày công\r\n    const { count: workingDaysCount } = await supabase\r\n      .from(\"attendance_logs\")\r\n      .select(\"*\", { count: \"exact\", head: true })\r\n      .eq(\"employee_id\", emp.id)\r\n      .gte(\"check_in\", startDate)\r\n      .lte(\"check_in\", endDate + \"T23:59:59\")\r\n\r\n    // Đếm ngày nghỉ phép\r\n    const { data: leaveRequests } = await supabase\r\n      .from(\"leave_requests\")\r\n      .select(\"from_date, to_date, leave_type\")\r\n      .eq(\"employee_id\", emp.id)\r\n      .eq(\"status\", \"approved\")\r\n      .lte(\"from_date\", endDate)\r\n      .gte(\"to_date\", startDate)\r\n\r\n    let leaveDays = 0\r\n    let unpaidLeaveDays = 0\r\n\r\n    if (leaveRequests) {\r\n      for (const leave of leaveRequests) {\r\n        const leaveStart = new Date(Math.max(new Date(leave.from_date).getTime(), new Date(startDate).getTime()))\r\n        const leaveEnd = new Date(Math.min(new Date(leave.to_date).getTime(), new Date(endDate).getTime()))\r\n        const days = Math.ceil((leaveEnd.getTime() - leaveStart.getTime()) / (1000 * 60 * 60 * 24)) + 1\r\n\r\n        if (leave.leave_type === \"unpaid\") {\r\n          unpaidLeaveDays += days\r\n        } else {\r\n          leaveDays += days\r\n        }\r\n      }\r\n    }\r\n\r\n    const workingDays = workingDaysCount || 0\r\n\r\n    // Lấy shift của nhân viên\r\n    const shift = emp.shift_id ? shiftMap.get(emp.shift_id) : null\r\n    const shiftStartTime = shift?.start_time?.slice(0, 5) || \"08:00\"\r\n\r\n    // Lấy vi phạm chấm công\r\n    const violations = await getEmployeeViolations(supabase, emp.id, startDate, endDate, shiftStartTime)\r\n    const lateCount = violations.filter((v) => v.lateMinutes > 0).length\r\n\r\n    // Lấy các điều chỉnh được gán cho nhân viên\r\n    const { data: empAdjustments } = await supabase\r\n      .from(\"employee_adjustments\")\r\n      .select(\"*, adjustment_type:payroll_adjustment_types(*)\")\r\n      .eq(\"employee_id\", emp.id)\r\n      .lte(\"effective_date\", endDate)\r\n      .or(`end_date.is.null,end_date.gte.${startDate}`)\r\n\r\n    // =============================================\r\n    // TÍNH TOÁN PHỤ CẤP, KHẤU TRỪ, PHẠT\r\n    // =============================================\r\n    let totalAllowances = salaryAllowance // Phụ cấp từ salary structure\r\n    let totalDeductions = 0\r\n    let totalPenalties = 0\r\n    const adjustmentDetails: any[] = []\r\n\r\n    // Xử lý các loại điều chỉnh tự động\r\n    if (adjustmentTypes) {\r\n      for (const adjType of adjustmentTypes as PayrollAdjustmentType[]) {\r\n        if (!adjType.is_auto_applied) continue\r\n\r\n        const rules = adjType.auto_rules\r\n        if (!rules) continue\r\n\r\n        if (adjType.category === \"allowance\") {\r\n          // Phụ cấp ăn trưa - tính theo ngày công\r\n          if (adjType.calculation_type === \"daily\") {\r\n            let eligibleDays = workingDays\r\n\r\n            // Trừ ngày nghỉ\r\n            if (rules.deduct_on_absent) {\r\n              eligibleDays -= unpaidLeaveDays\r\n            }\r\n\r\n            // Trừ nếu đi muộn quá số lần cho phép\r\n            if (rules.deduct_on_late && rules.late_grace_count !== undefined) {\r\n              const excessLateDays = Math.max(0, lateCount - rules.late_grace_count)\r\n              eligibleDays -= excessLateDays\r\n            }\r\n\r\n            eligibleDays = Math.max(0, eligibleDays)\r\n            const amount = eligibleDays * adjType.amount\r\n\r\n            if (amount > 0) {\r\n              totalAllowances += amount\r\n              adjustmentDetails.push({\r\n                adjustment_type_id: adjType.id,\r\n                category: \"allowance\",\r\n                base_amount: workingDays * adjType.amount,\r\n                adjusted_amount: (workingDays - eligibleDays) * adjType.amount,\r\n                final_amount: amount,\r\n                reason: `${eligibleDays} ngày x ${adjType.amount.toLocaleString()}đ`,\r\n                occurrence_count: eligibleDays,\r\n              })\r\n            }\r\n          }\r\n\r\n          // Phụ cấp chuyên cần - mất toàn bộ nếu vi phạm\r\n          if (adjType.calculation_type === \"fixed\" && rules.full_deduct_threshold !== undefined) {\r\n            const shouldDeduct = lateCount > rules.full_deduct_threshold || unpaidLeaveDays > 0\r\n            if (!shouldDeduct) {\r\n              totalAllowances += adjType.amount\r\n              adjustmentDetails.push({\r\n                adjustment_type_id: adjType.id,\r\n                category: \"allowance\",\r\n                base_amount: adjType.amount,\r\n                adjusted_amount: 0,\r\n                final_amount: adjType.amount,\r\n                reason: \"Đủ điều kiện chuyên cần\",\r\n                occurrence_count: 1,\r\n              })\r\n            } else {\r\n              adjustmentDetails.push({\r\n                adjustment_type_id: adjType.id,\r\n                category: \"allowance\",\r\n                base_amount: adjType.amount,\r\n                adjusted_amount: adjType.amount,\r\n                final_amount: 0,\r\n                reason: `Mất phụ cấp: đi muộn ${lateCount} lần, nghỉ không phép ${unpaidLeaveDays} ngày`,\r\n                occurrence_count: 0,\r\n              })\r\n            }\r\n          }\r\n        }\r\n\r\n        // Phạt đi muộn - đọc threshold từ auto_rules\r\n        if (adjType.category === \"penalty\" && rules.trigger === \"late\") {\r\n          const thresholdMinutes = rules.late_threshold_minutes || 30\r\n          const exemptWithRequest = rules.exempt_with_request !== false // Mặc định là true\r\n\r\n          // Lọc các ngày vi phạm theo threshold từ database\r\n          const penaltyDays = violations.filter((v) => {\r\n            if (v.lateMinutes <= thresholdMinutes) return false\r\n            if (exemptWithRequest && v.hasApprovedRequest) return false\r\n            return true\r\n          })\r\n\r\n          for (const v of penaltyDays) {\r\n            let penaltyAmount = 0\r\n            if (rules.penalty_type === \"half_day_salary\") {\r\n              penaltyAmount = dailySalary / 2\r\n            } else if (rules.penalty_type === \"full_day_salary\") {\r\n              penaltyAmount = dailySalary\r\n            } else if (rules.penalty_type === \"fixed_amount\") {\r\n              penaltyAmount = adjType.amount\r\n            }\r\n\r\n            totalPenalties += penaltyAmount\r\n            adjustmentDetails.push({\r\n              adjustment_type_id: adjType.id,\r\n              category: \"penalty\",\r\n              base_amount: penaltyAmount,\r\n              adjusted_amount: 0,\r\n              final_amount: penaltyAmount,\r\n              reason: `Đi muộn ${v.lateMinutes} phút ngày ${v.date}`,\r\n              occurrence_count: 1,\r\n            })\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Xử lý các điều chỉnh được gán thủ công cho nhân viên\r\n    if (empAdjustments) {\r\n      for (const empAdj of empAdjustments) {\r\n        const adjType = empAdj.adjustment_type as PayrollAdjustmentType\r\n        if (!adjType || adjType.is_auto_applied) continue // Bỏ qua auto-applied (đã xử lý ở trên)\r\n\r\n        const amount = empAdj.custom_amount || adjType.amount\r\n\r\n        if (adjType.category === \"allowance\") {\r\n          totalAllowances += amount\r\n        } else if (adjType.category === \"deduction\") {\r\n          // Tính BHXH theo % lương cơ bản\r\n          let finalAmount = amount\r\n          if (adjType.auto_rules?.calculate_from === \"base_salary\" && adjType.auto_rules?.percentage) {\r\n            finalAmount = (baseSalary * adjType.auto_rules.percentage) / 100\r\n          }\r\n          totalDeductions += finalAmount\r\n          adjustmentDetails.push({\r\n            adjustment_type_id: adjType.id,\r\n            category: \"deduction\",\r\n            base_amount: amount,\r\n            adjusted_amount: 0,\r\n            final_amount: finalAmount,\r\n            reason: adjType.name,\r\n            occurrence_count: 1,\r\n          })\r\n        } else if (adjType.category === \"penalty\") {\r\n          totalPenalties += amount\r\n        }\r\n      }\r\n    }\r\n\r\n    // =============================================\r\n    // TÍNH LƯƠNG CUỐI CÙNG\r\n    // =============================================\r\n    const grossSalary = dailySalary * workingDays + dailySalary * leaveDays + totalAllowances\r\n    const totalDeduction = dailySalary * unpaidLeaveDays + totalDeductions + totalPenalties\r\n    const netSalary = grossSalary - totalDeduction\r\n\r\n    // Insert payroll item\r\n    const { data: payrollItem, error: insertError } = await supabase\r\n      .from(\"payroll_items\")\r\n      .insert({\r\n        payroll_run_id: run.id,\r\n        employee_id: emp.id,\r\n        working_days: workingDays,\r\n        leave_days: leaveDays,\r\n        unpaid_leave_days: unpaidLeaveDays,\r\n        base_salary: baseSalary,\r\n        allowances: totalAllowances,\r\n        total_income: grossSalary,\r\n        total_deduction: totalDeduction,\r\n        net_salary: netSalary,\r\n        note: totalPenalties > 0 \r\n          ? `Đi muộn: ${lateCount} lần, Phạt: ${adjustmentDetails.filter(d => d.category === 'penalty').length} lần`\r\n          : `Đi muộn: ${lateCount} lần`,\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (insertError) {\r\n      console.error(`Error inserting payroll item for ${emp.full_name}:`, insertError)\r\n    } else {\r\n      processedCount++\r\n\r\n      // Insert adjustment details\r\n      if (payrollItem && adjustmentDetails.length > 0) {\r\n        const detailsWithItemId = adjustmentDetails.map((d) => ({\r\n          ...d,\r\n          payroll_item_id: payrollItem.id,\r\n        }))\r\n        await supabase.from(\"payroll_adjustment_details\").insert(detailsWithItemId)\r\n      }\r\n    }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/payroll\")\r\n  return { success: true, data: run, message: `Đã tạo bảng lương cho ${processedCount} nhân viên` }\r\n}\r\n\r\n// =============================================\r\n// HR ACTIONS - LOCK/UNLOCK PAYROLL\r\n// =============================================\r\n\r\nexport async function lockPayroll(id: string) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase\r\n    .from(\"payroll_runs\")\r\n    .update({ status: \"locked\" })\r\n    .eq(\"id\", id)\r\n    .eq(\"status\", \"draft\")\r\n\r\n  if (error) {\r\n    console.error(\"Error locking payroll:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/payroll\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function markPayrollPaid(id: string) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase\r\n    .from(\"payroll_runs\")\r\n    .update({ status: \"paid\" })\r\n    .eq(\"id\", id)\r\n    .eq(\"status\", \"locked\")\r\n\r\n  if (error) {\r\n    console.error(\"Error marking payroll as paid:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/payroll\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function deletePayrollRun(id: string) {\r\n  const supabase = await createClient()\r\n\r\n  // Chỉ xóa được draft\r\n  const { error } = await supabase\r\n    .from(\"payroll_runs\")\r\n    .delete()\r\n    .eq(\"id\", id)\r\n    .eq(\"status\", \"draft\")\r\n\r\n  if (error) {\r\n    console.error(\"Error deleting payroll run:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/payroll\")\r\n  return { success: true }\r\n}\r\n\r\n// =============================================\r\n// HR ACTIONS - SALARY STRUCTURE\r\n// =============================================\r\n\r\nexport async function listSalaryStructure(\r\n  employee_id: string\r\n): Promise<SalaryStructure[]> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"salary_structure\")\r\n    .select(\"*\")\r\n    .eq(\"employee_id\", employee_id)\r\n    .order(\"effective_date\", { ascending: false })\r\n\r\n  if (error) {\r\n    console.error(\"Error listing salary structure:\", error)\r\n    return []\r\n  }\r\n\r\n  return data || []\r\n}\r\n\r\nexport async function createSalaryStructure(input: {\r\n  employee_id: string\r\n  base_salary: number\r\n  allowance?: number\r\n  effective_date: string\r\n  note?: string\r\n}) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase.from(\"salary_structure\").insert({\r\n    employee_id: input.employee_id,\r\n    base_salary: input.base_salary,\r\n    allowance: input.allowance || 0,\r\n    effective_date: input.effective_date,\r\n    note: input.note,\r\n  })\r\n\r\n  if (error) {\r\n    console.error(\"Error creating salary structure:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/employees\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function getMySalary(): Promise<SalaryStructure | null> {\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n  if (!user) return null\r\n\r\n  const { data: employee } = await supabase\r\n    .from(\"employees\")\r\n    .select(\"id\")\r\n    .eq(\"user_id\", user.id)\r\n    .single()\r\n\r\n  if (!employee) return null\r\n\r\n  const { data } = await supabase\r\n    .from(\"salary_structure\")\r\n    .select(\"*\")\r\n    .eq(\"employee_id\", employee.id)\r\n    .order(\"effective_date\", { ascending: false })\r\n    .limit(1)\r\n    .single()\r\n\r\n  return data || null\r\n}\r\n\r\n// =============================================\r\n// PAYROLL ADJUSTMENT DETAILS\r\n// =============================================\r\n\r\nexport async function getPayrollAdjustmentDetails(payroll_item_id: string) {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"payroll_adjustment_details\")\r\n    .select(`\r\n      *,\r\n      adjustment_type:payroll_adjustment_types(id, name, code, category)\r\n    `)\r\n    .eq(\"payroll_item_id\", payroll_item_id)\r\n    .order(\"category\")\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching adjustment details:\", error)\r\n    return []\r\n  }\r\n\r\n  return data || []\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1347, "column": 0}, "map": {"version":3,"sources":["file:///E:/Pamo/v0-hrm/.next-internal/server/app/dashboard/employees/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getMyRoles as '005e20e2e268d812762b030e4aac3b7693066871b6'} from 'ACTIONS_MODULE0'\nexport {getMyEmployee as '00636a7c2e61bd285b975ea815e7fbbefdffae959f'} from 'ACTIONS_MODULE0'\nexport {listEmployees as '00b0c7f0352396833a3aa70b738bb3a8c2a485efae'} from 'ACTIONS_MODULE0'\nexport {createEmployee as '4072cdebcca1df607d08f62096843ddf91d2cf29f6'} from 'ACTIONS_MODULE0'\nexport {updateMyProfile as '407a7f2085358134fb9b61998dbd9fa880ad52c2cf'} from 'ACTIONS_MODULE0'\nexport {getEmployee as '409df3c5b25ea33596f872aab0b186da47271a8e80'} from 'ACTIONS_MODULE0'\nexport {updateEmployee as '60e7529b55507157f11112b5c625757ac226a23a7c'} from 'ACTIONS_MODULE0'\nexport {changeDepartment as '701419c868154523741dd2880ac65e97064ceb8620'} from 'ACTIONS_MODULE0'\nexport {changePosition as '70daddb01ea9f495d095baa024616ddfa6ee94f8dd'} from 'ACTIONS_MODULE0'\nexport {listPositions as '00a7b0eb530c1dc0860ad907a2b4ca6b37a0b9a499'} from 'ACTIONS_MODULE1'\nexport {listDepartments as '00c65c5a01ab8a9197dc80e277b1c810297c84835b'} from 'ACTIONS_MODULE1'\nexport {deleteDepartment as '402616c2ab184155e396b1e6bcc02aabf0a6699775'} from 'ACTIONS_MODULE1'\nexport {createDepartment as '403f54aab920d72630f1950530679072dce425d89b'} from 'ACTIONS_MODULE1'\nexport {createPosition as '409e900c57851e187b3336b2167f1492044da6a704'} from 'ACTIONS_MODULE1'\nexport {deletePosition as '40aea3118faebbf9d172394b8bba6bb810349e9ab4'} from 'ACTIONS_MODULE1'\nexport {updatePosition as '6071aab31133d8547de504c62c5c9a87df6b39a753'} from 'ACTIONS_MODULE1'\nexport {updateDepartment as '607ed26f2ae230819db894ad494358f3f62fa91173'} from 'ACTIONS_MODULE1'\nexport {listWorkShifts as '002f9d6345a5a511f01152040fcd0fa52b4139fa39'} from 'ACTIONS_MODULE2'\nexport {getMyShift as '00cff4a0838b0d5761bdee4b5a75d0a5299141c758'} from 'ACTIONS_MODULE2'\nexport {createWorkShift as '4087a37486892d33a9d94464ac3eea2cae1a6c9704'} from 'ACTIONS_MODULE2'\nexport {deleteWorkShift as '40f0914397b5f127d767a7e9a05d4d194efbe4f8c0'} from 'ACTIONS_MODULE2'\nexport {assignShiftToEmployee as '60bda9c7aba221f5c86fe1b4c9f7767110548a0047'} from 'ACTIONS_MODULE2'\nexport {updateWorkShift as '60fdca0f6d3ab43d79126edcb587d20015a30b4bda'} from 'ACTIONS_MODULE2'\nexport {listRoles as '0097c3129de9cf1d3adf136a94f5f66e954225c328'} from 'ACTIONS_MODULE3'\nexport {getUserRoles as '40d4296192d46fc6d3bafbc1e7eeb33175bee61916'} from 'ACTIONS_MODULE3'\nexport {removeRole as '603872d18a8d26811f97db0a49677da73b8c05517e'} from 'ACTIONS_MODULE3'\nexport {assignRole as '702ebe0b68ede1d0770971a4789fa6231867056663'} from 'ACTIONS_MODULE3'\nexport {getMyJobHistory as '0014a87925f0b58c47399356b40ebb5efeae275d38'} from 'ACTIONS_MODULE4'\nexport {createJobHistory as '407e5ed2f18c4c9e796737f7c0f1000e2967899e15'} from 'ACTIONS_MODULE4'\nexport {getEmployeeJobHistory as '40e7c2b4fb3fa229f80821da1babf0c7cc23dbff88'} from 'ACTIONS_MODULE4'\nexport {updateJobHistory as '609f9bf94bc0b4d6eb3a783ea29e2b33bb476307d2'} from 'ACTIONS_MODULE4'\nexport {getMyPayslips as '0027c1e01b93865d4e16c3244c190cf17597c3b79e'} from 'ACTIONS_MODULE5'\nexport {getMySalary as '00b639924a14db7d0577b90723c619fb29cb3da08b'} from 'ACTIONS_MODULE5'\nexport {listPayrollRuns as '00edcd0b8e08912a509842ed084d383437e0528e1c'} from 'ACTIONS_MODULE5'\nexport {listSalaryStructure as '402e74e37af9c1c3c31327905012407b40504ecb97'} from 'ACTIONS_MODULE5'\nexport {getPayrollRun as '403793e92e5baa492f2b0f99308903779c0f101b79'} from 'ACTIONS_MODULE5'\nexport {markPayrollPaid as '403a965c140936f6d06f11d2499e56c3ac24eeaa42'} from 'ACTIONS_MODULE5'\nexport {getPayrollItems as '40412a36516808b7d52f3f9eebce91052552a1b9f1'} from 'ACTIONS_MODULE5'\nexport {createSalaryStructure as '40518eb5fd5da1dddc47d27c07ef37c3d1370a0081'} from 'ACTIONS_MODULE5'\nexport {getPayrollAdjustmentDetails as '40760250a0f0276425dcf05a519fbffe7aee716735'} from 'ACTIONS_MODULE5'\nexport {lockPayroll as '40ede0ab5a9b6f1a8f1980612375ce413cfe2ce638'} from 'ACTIONS_MODULE5'\nexport {deletePayrollRun as '40f2270b430b959da8d042c7480dee4f84df06ed44'} from 'ACTIONS_MODULE5'\nexport {generatePayroll as '60969965aa57ad25a2e7fe770299bcab193808ffbc'} from 'ACTIONS_MODULE5'\nexport {updateEmployee as '60e7529b55507157f11112b5c625757ac226a23a7c'} from 'ACTIONS_MODULE0'\nexport {assignRole as '702ebe0b68ede1d0770971a4789fa6231867056663'} from 'ACTIONS_MODULE3'\nexport {removeRole as '603872d18a8d26811f97db0a49677da73b8c05517e'} from 'ACTIONS_MODULE3'\nexport {createSalaryStructure as '40518eb5fd5da1dddc47d27c07ef37c3d1370a0081'} from 'ACTIONS_MODULE5'\n"],"names":[],"mappings":";AAAA;AASA;AAQA;AAMA;AAIA;AAIA"}}]
}