{"version":3,"sources":["../../../../lib/actions/department-actions.ts","../../../../lib/actions/role-actions.ts","../../../../.next-internal/server/app/dashboard/employees/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport type { Department, Position } from \"@/lib/types/database\"\r\n\r\nexport async function listDepartments(): Promise<Department[]> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase.from(\"departments\").select(\"*\").order(\"name\")\r\n\r\n  if (error) {\r\n    console.error(\"Error listing departments:\", error)\r\n    return []\r\n  }\r\n\r\n  return data || []\r\n}\r\n\r\nexport async function listPositions(): Promise<Position[]> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase.from(\"positions\").select(\"*\").order(\"level\", { ascending: false })\r\n\r\n  if (error) {\r\n    console.error(\"Error listing positions:\", error)\r\n    return []\r\n  }\r\n\r\n  return data || []\r\n}\r\n\r\nexport async function createDepartment(data: { name: string; code?: string; parent_id?: string }) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase.from(\"departments\").insert(data)\r\n\r\n  if (error) {\r\n    console.error(\"Error creating department:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/departments\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function updateDepartment(id: string, data: { name?: string; code?: string; parent_id?: string | null }) {\r\n  const supabase = await createClient()\r\n\r\n  const { error } = await supabase.from(\"departments\").update(data).eq(\"id\", id)\r\n\r\n  if (error) {\r\n    console.error(\"Error updating department:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/departments\")\r\n  return { success: true }\r\n}\r\n","\"use server\"\r\n\r\nimport { createClient } from \"@/lib/supabase/server\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport type { Role, RoleCode } from \"@/lib/types/database\"\r\n\r\nexport async function listRoles(): Promise<Role[]> {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase.from(\"roles\").select(\"*\").order(\"name\")\r\n\r\n  if (error) {\r\n    console.error(\"Error listing roles:\", error)\r\n    return []\r\n  }\r\n\r\n  return data || []\r\n}\r\n\r\nexport async function assignRole(userId: string, roleCode: RoleCode, departmentId?: string) {\r\n  const supabase = await createClient()\r\n\r\n  // Get role id from code\r\n  const { data: role } = await supabase.from(\"roles\").select(\"id\").eq(\"code\", roleCode).single()\r\n\r\n  if (!role) {\r\n    return { success: false, error: \"Role not found\" }\r\n  }\r\n\r\n  const { error } = await supabase.from(\"user_roles\").upsert(\r\n    {\r\n      user_id: userId,\r\n      role_id: role.id,\r\n      department_id: departmentId || null,\r\n    },\r\n    {\r\n      onConflict: \"user_id,role_id\",\r\n    },\r\n  )\r\n\r\n  if (error) {\r\n    console.error(\"Error assigning role:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/employees\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function removeRole(userId: string, roleCode: RoleCode) {\r\n  const supabase = await createClient()\r\n\r\n  // Get role id from code\r\n  const { data: role } = await supabase.from(\"roles\").select(\"id\").eq(\"code\", roleCode).single()\r\n\r\n  if (!role) {\r\n    return { success: false, error: \"Role not found\" }\r\n  }\r\n\r\n  const { error } = await supabase.from(\"user_roles\").delete().eq(\"user_id\", userId).eq(\"role_id\", role.id)\r\n\r\n  if (error) {\r\n    console.error(\"Error removing role:\", error)\r\n    return { success: false, error: error.message }\r\n  }\r\n\r\n  revalidatePath(\"/dashboard/employees\")\r\n  return { success: true }\r\n}\r\n\r\nexport async function getUserRoles(userId: string) {\r\n  const supabase = await createClient()\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"user_roles\")\r\n    .select(`\r\n      *,\r\n      role:roles(*)\r\n    `)\r\n    .eq(\"user_id\", userId)\r\n\r\n  if (error) {\r\n    console.error(\"Error fetching user roles:\", error)\r\n    return []\r\n  }\r\n\r\n  return data || []\r\n}\r\n","export {listEmployees as '00615a52a55e0a543ef75e5baea30072c1753e165d'} from 'ACTIONS_MODULE0'\nexport {getMyRoles as '00883990eb87fcbb43d391263ac0e80258f50fa142'} from 'ACTIONS_MODULE0'\nexport {getMyEmployee as '00b03b68086147c4f3c87b418d7c215dd6cb117979'} from 'ACTIONS_MODULE0'\nexport {updateMyProfile as '4079a4797cba7170c9f24cb929d39c5458459914fe'} from 'ACTIONS_MODULE0'\nexport {createEmployee as '40ddf02cc5e4765fa3a030fd637e5f355c5f442611'} from 'ACTIONS_MODULE0'\nexport {getEmployee as '40e459b772c74c679b1dae2e3f27180379dec5296b'} from 'ACTIONS_MODULE0'\nexport {updateEmployee as '602895f5cf22992ec5b7c548983ba3ab1dbcb8093a'} from 'ACTIONS_MODULE0'\nexport {listPositions as '0031c11a418a59d70344f445ed7cb987eb2d1bd072'} from 'ACTIONS_MODULE1'\nexport {listDepartments as '00cb34bb7586d41871dfb9563a4a3bb133f4f4fb9c'} from 'ACTIONS_MODULE1'\nexport {createDepartment as '40d43bd0abacbac93f2bc354b1ff4c566d9c7aa34b'} from 'ACTIONS_MODULE1'\nexport {updateDepartment as '60f9a1ddfff114a346f6210ccc32da65669ccd624a'} from 'ACTIONS_MODULE1'\nexport {listRoles as '006908b65105a6649dde5900b3192cddc326f6f2a9'} from 'ACTIONS_MODULE2'\nexport {getUserRoles as '40a61802a1e18ea2d934a26f4496a52b4191335753'} from 'ACTIONS_MODULE2'\nexport {removeRole as '605ea632d708723700721e3ac66b7c5364f937262c'} from 'ACTIONS_MODULE2'\nexport {assignRole as '70797d62fb53121d1b1491d358e9110f184df7ce20'} from 'ACTIONS_MODULE2'\nexport {updateEmployee as '602895f5cf22992ec5b7c548983ba3ab1dbcb8093a'} from 'ACTIONS_MODULE0'\nexport {assignRole as '70797d62fb53121d1b1491d358e9110f184df7ce20'} from 'ACTIONS_MODULE2'\nexport {removeRole as '605ea632d708723700721e3ac66b7c5364f937262c'} from 'ACTIONS_MODULE2'\n"],"names":[],"mappings":"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"}